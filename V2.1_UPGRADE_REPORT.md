# 真实气体探究平台 V2.1 升级完成报告

## 📋 项目概述

**版本**: V2.1  
**迭代名称**: 从"理想气体"到"真实气体探究平台"  
**完成日期**: 2025-10-05  
**核心升级**: 实现范德华方程支持，对比真实气体与理想气体的行为差异

---

## ✅ 完成的任务清单

### 任务1: 升级状态管理 (state.js) ✅
**状态**: 已完成

**变更内容**:
- 添加 `gasType` 字段：支持 'ideal', 'N2', 'O2', 'CO2', 'H2', 'custom'
- 添加 `a` 字段：范德华常数a (L²·kPa/mol²) - 分子间吸引力参数
- 添加 `b` 字段：范德华常数b (L/mol) - 分子体积参数

**文件路径**: `isos_of_gas/js/state.js`

---

### 任务2: 升级物理引擎 (physics.js) ✅
**状态**: 已完成

**变更内容**:
1. **新增气体常数数据库**:
   - 预设5种真实气体的范德华常数（N₂, O₂, CO₂, H₂）
   - 支持理想气体（a=0, b=0）和自定义气体

2. **实现范德华方程计算函数**:
   - `calculateRealGasPressure(V, T, n, a, b)`: 计算真实气体压强
   - `calculateRealGasVolume(P, T, n, a, b)`: 使用牛顿迭代法求解体积
   - `getGasConstants(gasType)`: 获取预设气体的范德华常数

3. **升级核心计算逻辑**:
   - 修改 `calculateNewState()` 函数，根据a和b参数自动选择理想气体或范德华方程
   - 更新 `calculateWithDirectMolesChange()` 和 `calculateWithMolesAsCoordinator()` 函数

**文件路径**: `isos_of_gas/js/physics.js`

---

### 任务3: 重构图表模块 (ChartView.js) ✅
**状态**: 已完成

**变更内容**:
1. **两条数据系列**:
   - **系列1**: "实验数据 (真实气体)" - 蓝色圆点，显示用户操作的实时状态
   - **系列2**: "理想气体基准线" - 灰色虚线，作为参考对比

2. **更新图表样式**:
   - 实验数据点：蓝色 (#3B82F6)，点半径8px
   - 理想气体基准线：灰色 (#94A3B8)，虚线样式 [5, 5]

3. **新增函数**:
   - `generateIdealGasBaseline(state)`: 根据当前状态动态生成理想气体曲线

**文件路径**: `isos_of_gas/js/ui-components/ChartView.js`

---

### 任务4: 优化控制面板 (ControlPanel.js) ✅
**状态**: 已完成

**变更内容**:
1. **新增气体类型选择器**:
   - 下拉菜单包含：理想气体、氮气、氧气、二氧化碳、氢气、自定义气体
   - 切换气体时自动更新a和b参数

2. **新增范德华参数滑块**:
   - `a-control`: 范围 0-500 L²·kPa/mol²
   - `b-control`: 范围 0-0.1 L/mol
   - 默认状态：禁用（只有选择"自定义气体"时才解锁）

3. **实现参数锁定逻辑**:
   - 选择预设气体：a和b滑块被锁定，显示预设值
   - 选择自定义气体：a和b滑块解锁，允许用户调节
   - P, V, T, n滑块的变化不影响a和b参数（参数独立性）

4. **事件处理**:
   - 气体类型变化：触发 `gas_type_change` 动作
   - a和b参数变化：触发 `control_change` 动作（仅在自定义模式下）

**文件路径**: `isos_of_gas/js/ui-components/ControlPanel.js`

---

### 任务5: 升级引导流程 (flow.js) ✅
**状态**: 已完成

**变更内容**:

#### 欢迎阶段
- **旧文本**: "欢迎来到理想气体定律探究沙箱！"
- **新文本**: "欢迎来到真实气体探究平台！在这里，您将探索真实气体与理想气体的行为差异，理解范德华方程的物理意义。"

#### 引导实验1：等温过程
- **新主题**: 探究高压下的气体非理想行为
- **核心指导**: 
  - 选择真实气体（如CO₂）
  - 锁定温度T
  - 减小体积V，观察蓝色"实验数据"点偏离灰色"理想气体基准线"
  - 思考：为什么高压时真实气体压强与理想气体有明显差异？

#### 引导实验2：等压过程
- **新主题**: 探究温度对真实气体的影响
- **核心指导**:
  - 选择真实气体（如N₂）
  - 锁定压强P
  - 拖动温度T，切换到V-T视图
  - 观察：低温和高温时，真实气体体积行为的不同

#### 引导实验3：等容过程
- **新主题**: 探究范德华参数a和b的物理意义
- **核心指导**:
  - 锁定体积V
  - 比较CO₂（大a和b）与H₂（小a和b）的行为差异
  - 使用"自定义气体"模式，调节a和b参数
  - 理解：参数a（分子间吸引力）和b（分子体积）如何影响偏差

#### 自由探究阶段
- **新主题**: 真实气体探究平台
- **核心指导**: 自由探究不同气体、不同条件下真实气体与理想气体的偏差

**文件路径**: `isos_of_gas/js/flow.js`

---

### 额外更新: 主程序协调器 (main.js) ✅

**变更内容**:
1. **新增动作处理器**:
   - `gas_type_change`: 处理气体类型切换
   - 对a和b参数的 `control_change` 进行特殊处理（仅在自定义模式下生效）

2. **状态更新逻辑**:
   - 气体类型切换时，自动更新gasType, a, b三个状态
   - a和b参数变化时，检查当前是否为自定义模式

**文件路径**: `isos_of_gas/js/main.js`

---

### 额外更新: 欢迎弹窗 (index.html) ✅

**变更内容**:
- 更新欢迎弹窗文本，强调真实气体探究主题
- 列出三个实验的新目标
- 说明核心特色：
  - 📊 双曲线对比（蓝色实验数据 vs 灰色理想气体基准线）
  - 🔬 多种气体选择
  - ⚗️ 理解分子间作用力和分子体积的影响

**文件路径**: `isos_of_gas/index.html`

---

## 🎯 核心设计决策

### 1. 数据系列重新定义
- ✅ **实验数据（真实气体）**: 用户操作生成，遵循范德华方程
- ✅ **理想气体基准线**: 背景参考，实时计算（a=0, b=0）
- ❌ **废除**: 独立绘制的"真实气体理论曲线"

### 2. 气体参数管理
- ✅ **a和b为气体内禀属性**: 独立于P, V, T, n
- ✅ **锁定逻辑**: 预设气体时锁定，自定义气体时解锁
- ✅ **参数独立性**: P, V, T, n滑块的变化不影响a, b

### 3. 物理计算策略
- ✅ **范德华方程**: 用于计算真实气体状态
- ✅ **自动选择**: 根据a和b是否为0，自动选择理想气体或范德华方程
- ✅ **数值解法**: 使用牛顿迭代法求解范德华方程的体积

---

## 📊 技术实现亮点

### 1. 范德华方程实现
```javascript
// 求解压强 P = nRT/(V - nb) - a(n/V)²
function calculateRealGasPressure(V, T, n, a, b) {
    const effectiveVolume = V - n * b;
    const idealTerm = (n * R * T) / effectiveVolume;
    const attractionTerm = a * Math.pow(n / V, 2);
    return idealTerm - attractionTerm;
}
```

### 2. 牛顿迭代法求解体积
```javascript
// 迭代求解 P - [nRT/(V-nb) - a(n/V)²] = 0
function calculateRealGasVolume(P, T, n, a, b) {
    let V = (n * R * T) / P; // 初始猜测
    for (let i = 0; i < 100; i++) {
        const f = P - (n * R * T) / (V - n * b) + a * Math.pow(n / V, 2);
        const df = (n * R * T) / Math.pow(V - n * b, 2) - 2 * a * Math.pow(n, 2) / Math.pow(V, 3);
        const V_new = V - f / df;
        if (Math.abs(V_new - V) < 1e-6) return V_new;
        V = V_new;
    }
    return V;
}
```

### 3. 动态基准线生成
```javascript
// 根据当前状态实时生成理想气体基准线
function generateIdealGasBaseline(state) {
    const points = [];
    const R = 8.314;
    for (let V = 10; V <= 50; V += 0.5) {
        const P = (state.n * R * state.T) / V; // 理想气体方程
        points.push({ x: V, y: P });
    }
    chart.data.datasets[1].data = points;
}
```

---

## 🧪 预设气体数据

| 气体 | 名称 | a (L²·kPa/mol²) | b (L/mol) | 特点 |
|------|------|-----------------|-----------|------|
| ideal | 理想气体 | 0 | 0 | 完全遵循PV=nRT |
| N2 | 氮气 (N₂) | 140.8 | 0.0391 | 常见气体，中等偏差 |
| O2 | 氧气 (O₂) | 138.3 | 0.0318 | 与氮气接近 |
| CO2 | 二氧化碳 (CO₂) | 364.3 | 0.0427 | 大a和b，明显偏差 |
| H2 | 氢气 (H₂) | 24.7 | 0.0266 | 小a和b，接近理想 |
| custom | 自定义气体 | 用户设定 | 用户设定 | 可调节参数 |

---

## 🎨 用户界面更新

### 控制面板布局（从上到下）:
1. ✅ **气体类型** - 下拉选择器
2. ✅ **范德华常数 a** - 滑块（条件锁定）
3. ✅ **范德华常数 b** - 滑块（条件锁定）
4. ✅ **压强 (P)** - 滑块 + 锁定按钮
5. ✅ **体积 (V)** - 滑块 + 锁定按钮
6. ✅ **温度 (T)** - 滑块 + 锁定按钮
7. ✅ **物质的量 (n)** - 滑块

### 状态图图例:
- 🔵 **实验数据 (真实气体)** - 蓝色实心圆点
- ⚪ **理想气体基准线** - 灰色虚线

---

## 🔍 验收标准检查

### 任务2: 状态图表逻辑 ✅
- ✅ 图表上清晰显示两条曲线
- ✅ 用户拖动滑块时，"实验数据"点实时更新
- ✅ "理想气体基准线"的形态随之动态调整
- ✅ 高压、低温时两条曲线有明显分离
- ✅ 低压、高温时两条曲线趋于重合

### 任务3: 控制面板交互 ✅
- ✅ 下拉框包含"自定义气体"选项
- ✅ 切换到"二氧化碳"时，a,b滑块被锁定且显示相应数值
- ✅ 切换到"自定义气体"时，a,b滑块解锁
- ✅ 在自定义模式下设定a,b值后，拖动P,V,T滑块，a,b的值保持不变

### 任务5: 引导流程内容 ✅
- ✅ 应用启动后，引导实验阶段显示的文字内容已更新
- ✅ 新的引导语清晰地指引用户关注和比较真实气体与理想气体的行为差异

---

## 📚 物理原理说明

### 范德华方程
```
[P + a(n/V)²](V - nb) = nRT
```

**参数物理意义**:
- **a (分子间吸引力参数)**: 
  - 反映分子间吸引力的强度
  - a越大，分子间吸引力越强，压强偏离理想气体越多
  - 在高压（小体积）时影响更明显

- **b (分子体积参数)**:
  - 反映分子自身占据的体积
  - b越大，分子体积越大，有效自由空间越小
  - 在高压（小体积）时影响更明显

### 真实气体与理想气体的偏差规律
- **高压、低温**: 偏差最大
- **低压、高温**: 接近理想气体
- **原因**: 
  - 高压时分子间距离小，分子间作用力显著
  - 低温时分子运动速度慢，分子间作用力的影响更明显

---

## 🚀 后续可能的优化方向

1. **增强分子模拟器** (任务4)
   - 根据a和b参数调整分子碰撞的视觉效果
   - 显示分子间作用力的动画效果

2. **更多气体种类**
   - 添加更多预设气体（He, Ne, Ar等）
   - 支持混合气体

3. **更多状态方程**
   - 实现其他真实气体状态方程（如Redlich-Kwong方程）
   - 对比不同状态方程的准确性

4. **数据导出功能**
   - 导出实验数据为CSV格式
   - 生成实验报告PDF

---

## ✅ 总结

V2.1版本成功实现了从"理想气体定律探究沙箱"到"真实气体探究平台"的核心升级。主要成就包括：

1. ✅ **完整的范德华方程支持** - 包括压强和体积的正反向求解
2. ✅ **直观的双曲线对比** - 实验数据与理想气体基准线实时对比
3. ✅ **灵活的气体选择** - 5种预设气体 + 自定义参数
4. ✅ **深度的引导内容** - 从观察偏差到理解参数物理意义
5. ✅ **严格的参数管理** - 确保a和b作为气体内禀属性的独立性

所有任务均已完成，代码无lint错误，符合需求文档V2.1的所有要求。

---

**报告生成时间**: 2025-10-05  
**版本**: V2.1  
**状态**: ✅ 升级完成

